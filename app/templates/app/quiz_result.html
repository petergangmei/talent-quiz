{% extends 'base.html' %}
{% load quiz_extras %}

{% block title %}Results: {{ quiz.title }} | Quiz App{% endblock %}

{% block og_title %}Quiz Results: {{ quiz.title }}{% endblock %}
{% block og_description %}See your result for the {{ quiz.title }} quiz!{% endblock %}

{% block extra_head %}
<style>
    .card {
        background-color: var(--bg-card);
        border: none;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        color: var(--text-light);
    }
    
    .card-header {
        background-color: var(--bg-darker) !important;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-light);
    }
    
    .card-body {
        color: var(--text-light);
    }
    
    .card-footer {
        background-color: var(--bg-darker);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .table {
        color: var(--text-light);
    }
    
    .table-striped tbody tr:nth-of-type(odd) {
        background-color: rgba(255, 255, 255, 0.05);
    }
    
    .table th, .table td {
        border-color: rgba(255, 255, 255, 0.1);
    }
    
    .alert-warning {
        background-color: rgba(240, 173, 78, 0.2);
        border-color: rgba(240, 173, 78, 0.3);
        color: #f5e2c6;
    }
    
    .alert-info {
        background-color: rgba(91, 192, 222, 0.2);
        border-color: rgba(91, 192, 222, 0.3);
        color: #d1ecf6;
    }
    
    .display-4 {
        color: var(--primary);
    }
    
    .lead {
        color: var(--text-light);
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card mb-4">
                <div class="card-header">
                    <h1 class="h2 mb-0 text-primary">Your Results: {{ quiz.title }}</h1>
                </div>
                <div class="card-body">
                    {% if result_data.primary_category %}
                        <div class="text-center mb-4">
                            <h2 class="display-4">{{ result_data.primary_category }}</h2>
                            <p class="lead">Score: {{ result_data.primary_score }}</p>
                            {% if result_interpretations.primary_category %}
                                <div class="mt-3">
                                    <p>{{ result_interpretations.primary_category }}</p>
                                </div>
                            {% endif %}
                        </div>

                        {% if result_data.secondary_gifts %}
                            <h3 class="mt-4 text-primary">Secondary Gifts</h3>
                            {% for gift in result_data.secondary_gifts %}
                                <div class="card mb-3">
                                    <div class="card-header">
                                        <h4>{{ gift.category }} (Score: {{ gift.score }})</h4>
                                    </div>
                                    <div class="card-body">
                                        {% if gift.category in result_interpretations %}
                                            <p>{{ result_interpretations|get_item:gift.category }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}

                        <h3 class="mt-4 text-primary">All Scores</h3>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Category</th>
                                        <th>Score</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for category, score in result_data.scores.items %}
                                    <tr>
                                        <td>{{ category }}</td>
                                        <td>{{ score }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-warning">
                            <p>No results were calculated. This could be because you skipped too many questions or the quiz is not configured correctly.</p>
                        </div>
                    {% endif %}
                    
                    <div class="alert alert-info mt-4">
                        <p><i class="fas fa-link"></i> Bookmark this page to access your results later. Your results will be available until {{ user_quiz.expires_at|date:"F j, Y" }}.</p>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'quiz-start' quiz.id %}" class="btn btn-outline-primary">Retake Quiz</a>
                        <a href="{% url 'home' %}" class="btn btn-primary">Back to Home</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Template filter implementation for accessing dictionary values by key 
    // (needed for result_interpretations dictionary)
    if (!window.filters) {
        window.filters = {};
    }
    
    window.filters.get_item = function(dictionary, key) {
        return dictionary[key];
    };
    
    // Register custom template filter
    if (typeof django !== 'undefined' && django.template) {
        django.template.defaultfilters.get_item = window.filters.get_item;
    }
</script>
{% endblock %} 